<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Astro Chat - Global Edition</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2554/2554978.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Fonte Pixelada para o estilo Retro -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">

   <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="dark" data-bubble-style="astro" data-bg-style="cosmos" data-chat-bg="whatsapp">
    
    <!-- Script para altura mobile -->
    <script>
        const setAppHeight = () => {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        };
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

     <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-[100] bg-[#0f172a] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative w-32 h-32 mb-8">
            <div class="absolute inset-0 border-4 border-blue-500/20 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-blue-500 rounded-full animate-spin border-t-transparent"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="fas fa-rocket text-4xl text-blue-500"></i>
            </div>
        </div>
        <h1 class="text-2xl font-bold text-white tracking-widest font-pixel">ASTRO CHAT</h1>
        <p class="text-blue-400 mt-2 text-sm">Carregando universos...</p>
    </div>

    <!-- App Container -->
    <div id="app-container" class="w-full h-full flex items-center justify-center opacity-0 transition-opacity duration-500" style="height: var(--app-height);">
        
        <!-- Nickname Screen -->
        <div id="nickname-screen" class="w-full max-w-sm p-6 glassmorphism rounded-2xl shadow-lg flex-col gap-5 hidden sm:max-w-md md:max-w-lg">
             <h2 class="text-2xl font-bold text-center flex items-center justify-center gap-3"><i class="fas fa-user-astronaut text-indigo-400"></i>IdentificaÃ§Ã£o</h2>
            
            <!-- Campo Nome -->
            <div>
                <label for="nickname-input" class="text-sm font-medium text-muted-color">Seu Apelido</label>
                <input type="text" id="nickname-input" placeholder="Viajante Estelar" class="w-full mt-1 p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 text-center text-white">
            </div>

            <!-- Campo Idioma -->
            <div>
                <label for="intro-lang-selector" class="text-sm font-medium text-muted-color">Seu Idioma Principal</label>
                <div class="relative mt-1">
                     <select id="intro-lang-selector" class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 text-white cursor-pointer">
                        <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                        <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                     </select>
                     <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"></i>
                </div>
            </div>

            <button id="save-nickname-btn" class="w-full bg-[var(--primary-color)] hover:opacity-90 font-bold p-3 rounded-xl transition-all text-lg text-white shadow-lg mt-2">Entrar</button>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="w-full h-full max-w-md flex-col hidden relative sm:max-w-lg md:max-w-2xl bg-[var(--background-color)] md:bg-transparent md:h-5/6">
             <header class="flex items-center justify-between p-4 glassmorphism md:rounded-t-2xl z-10">
                <h2 class="text-xl font-bold">Conversas</h2>
                <div class="flex items-center gap-3">
                    <p class="text-sm">OlÃ¡, <span id="lobby-nickname" class="font-bold text-[var(--primary-color)]"></span>!</p>
                    <button id="change-nickname-btn" class="text-muted-color hover:text-text-color transition-colors" title="Sair / Trocar Conta"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </header>
            
            <main data-bubble-style="modern" id="room-list-container" class="md:rounded-b-2xl flex-1 overflow-y-auto p-4 space-y-3 scroll-container md:bg-[var(--surface-color)] md:bg-opacity-90"></main>

            <!-- BotÃ£o Config -->
            <div class="absolute bottom-6 left-6 z-20">
                 <button id="settings-btn" class="w-14 h-14 bg-[var(--surface-color)] hover:bg-opacity-80 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 border border-white/10 text-[var(--text-color)]">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>

            <!-- BotÃµes de AÃ§Ã£o (Nova Sala e IA) -->
            <div class="absolute bottom-6 right-6 z-20 flex flex-col gap-3">
                 <!-- BotÃ£o IA Mentor (NOVO) -->
                 <button id="ai-room-btn" class="w-16 h-16 bg-gradient-to-br from-purple-600 to-indigo-600 hover:opacity-90 rounded-full flex items-center justify-center shadow-lg transition-transform duration-300 transform hover:scale-110 text-white border-2 border-white/20" title="Conversar com IA">
                    <i class="fas fa-robot text-2xl"></i>
                </button>
                
                 <!-- BotÃ£o Nova Conversa -->
                 <button id="new-conversation-btn" class="w-16 h-16 bg-[var(--primary-color)] hover:opacity-90 rounded-full flex items-center justify-center shadow-lg transition-transform duration-300 transform hover:scale-110 text-white" title="Nova Sala">
                    <i class="fas fa-plus text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Chat Screen -->
        <div id="chat-screen" class="w-full h-full flex-col hidden bg-[var(--background-color)] md:max-w-4xl md:h-5/6 md:rounded-2xl md:shadow-2xl md:border md:border-white/5 relative">
            <header class="flex items-center justify-between p-3 glassmorphism md:rounded-t-2xl z-10 gap-2">
                <div class="flex items-center gap-2">
                    <button id="leave-btn" class="p-2 rounded-full hover:bg-white/10 text-lg transition-colors text-[var(--text-color)]">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div>
                        <div class="relative group cursor-pointer flex flex-col" id="room-code-wrapper">
                           <div class="flex items-center gap-3">
                                <div id="room-icon"
                                    class="w-10 h-10 rounded-xl flex items-center justify-center 
                                            bg-gradient-to-br from-blue-500 to-indigo-600 
                                            text-white shadow-lg transition-transform">
                                    <i class="fas fa-rocket text-lg"></i>
                                </div>

                                <div class="flex flex-col leading-tight">
                                    <span class="room-name-display font-bold text-lg"></span>
                                    <span class="text-xs opacity-60 font-mono flex">
                                        #<span class="room-code-value"></span> <p id="user-count-display" class="text-xs text-green-400 font-medium ml-2"></p>
                                    </span>
                                </div>
                            </div>                            
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <!-- BotÃ£o de NotificaÃ§Ã£o -->
                    <button id="notif-btn" class="text-[var(--text-muted-color)] hover:text-[var(--primary-color)] transition-colors p-1" title="Ativar NotificaÃ§Ãµes">
                        <i class="fas fa-bell-slash"></i>
                    </button>

                    <!-- NOVO: BotÃ£o Limpar Conversa (NA SALA) -->
                    <button id="room-clear-chat-btn" class="text-[var(--text-muted-color)] hover:text-red-400 transition-colors p-1" title="Limpar HistÃ³rico da Sala">
                        <i class="fas fa-eraser"></i>
                    </button>

                    <!-- Seletor de Idioma da Sala -->
                    <div class="flex items-center gap-2" id="room-lang-container">
                        <select id="room-lang-selector" title="Seu idioma pessoal para traduÃ§Ã£o">
                            <option value="pt">PortuguÃªs</option>
                            <option value="en">English</option>
                            <option value="es">EspaÃ±ol</option>
                            <option value="fr">FranÃ§ais</option>
                            <option value="de">Deutsch</option>
                            <option value="it">Italiano</option>
                            <option value="ja">æ—¥æœ¬èª</option>
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <!-- BotÃ£o de ConfiguraÃ§Ã£o dentro do chat tambÃ©m -->
                    <button id="chat-settings-btn" onclick="document.getElementById('settings-btn').click()" class="text-[var(--text-muted-color)] hover:text-[var(--text-color)] transition-colors p-1">
                        <i class="fas fa-cog"></i>
                    </button>

                    <div class="md:flex items-center -space-x-2 hidden" id="user-avatars-container"></div>
                </div>
            </header>

            <main id="messages-container" class="flex-1 p-4 overflow-y-auto flex flex-col scroll-container bg-[var(--surface-color)]/30">
                <div id="messages-list" class="flex flex-col gap-1 pb-4">
                    <div id="typing-indicator-container" class="h-8 transition-all duration-300"></div>
                </div>
            </main>

            <!-- Footer / Input Area -->
            <footer class="p-3 glassmorphism md:rounded-b-2xl z-20">                
                <div id="reply-preview" class="hidden mb-2 p-2 rounded-lg bg-black/20 border-l-4 border-[var(--secondary-color)]"></div>
                
                <div class="flex  gap-2 w-full">
                    <div class="flex-1 relative">
                        <textarea id="message-input" rows="1" placeholder="Digite uma mensagem..." class="w-full bg-[var(--surface-color)] text-[var(--text-color)] rounded-2xl py-3 px-4 outline-none focus:ring-2 focus:ring-[var(--primary-color)] border border-white/5 resize-none overflow-hidden max-h-32" style="min-height: 48px;"></textarea>
                    </div>
                    
                    <!-- BotÃµes de AÃ§Ã£o Agrupados e Alinhados -->
                    <div class="flex gap-1 shrink-0">
                        <button id="grammar-check-btn" style=" background: #334155" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 hover:bg-white/10 text-emerald-400" title="Corrigir GramÃ¡tica">
                            <i class="fas fa-check-double text-lg"></i>
                        </button>

                        <button id="rewrite-btn" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 hover:bg-white/10 text-purple-400" title="Melhorar texto com IA">
                            <i class="fas fa-magic text-lg"></i>
                        </button>

                        <button id="send-btn" class="bg-[var(--primary-color)] hover:opacity-90 w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 shadow-lg text-white">
                            <i class="fas fa-paper-plane text-lg"></i>
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm overflow-y-auto">
        <div class="glassmorphism p-0 rounded-2xl max-w-md w-full flex flex-col my-auto overflow-hidden max-h-[90vh]">
            <!-- Header do Modal -->
            <div class="p-4 border-b border-white/10 flex justify-between items-center bg-black/20 shrink-0">
                 <h3 class="text-lg font-bold flex items-center gap-2"><i class="fas fa-sliders-h text-[var(--primary-color)]"></i> ConfiguraÃ§Ãµes</h3>
                 <button id="close-settings-modal-btn" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-white/10 transition-colors">&times;</button>
            </div>

            <div class="p-6 space-y-8 overflow-y-auto scroll-container">
                
                <!-- PARTE 1: PERFIL E IDIOMA -->
                <section class="space-y-4">
                    <div class="flex items-center gap-2 border-b border-white/5 pb-2 mb-4">
                        <i class="fas fa-user-astronaut text-indigo-400"></i>
                        <h4 class="text-xs font-bold text-muted-color uppercase tracking-widest">Perfil & Idioma</h4>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-4">
                        <!-- Nickname -->
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Apelido</label>
                            <div class="relative">
                                <i class="fas fa-signature absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                                <input type="text" id="settings-nickname-input" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl py-2 pl-9 pr-3 text-white focus:ring-2 focus:ring-[var(--primary-color)] outline-none transition-all">
                            </div>
                        </div>

                        <!-- Idioma -->
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Idioma da IA</label>
                            <div class="relative">
                                <i class="fas fa-language absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                                <select id="settings-lang-selector" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl py-2 pl-9 pr-3 text-white appearance-none cursor-pointer focus:ring-2 focus:ring-[var(--primary-color)] outline-none transition-all">
                                    <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PARTE 2: VISUALIZAÃ‡ÃƒO -->
                <section class="space-y-4">
                    <div class="flex items-center gap-2 border-b border-white/5 pb-2 mb-4">
                        <i class="fas fa-palette text-pink-400"></i>
                        <h4 class="text-xs font-bold text-muted-color uppercase tracking-widest">AparÃªncia</h4>
                    </div>

                    <!-- Tema -->
                    <div class="flex gap-2">
                        <button data-theme="dark" class="theme-btn flex-1 p-3 rounded-xl border border-transparent bg-slate-800 text-white flex items-center justify-center gap-2 hover:bg-slate-700 transition-all">
                            <i class="fas fa-moon"></i> Dark
                        </button>
                        <button data-theme="light" class="theme-btn flex-1 p-3 rounded-xl border border-transparent bg-slate-200 text-black flex items-center justify-center gap-2 hover:bg-slate-300 transition-all">
                            <i class="fas fa-sun"></i> Light
                        </button>
                    </div>

                    <div class="space-y-3">
                        <!-- Selectors Grouped -->
                         <div>
                            <label class="text-sm text-slate-400 mb-1 block">Fundo do App</label>
                            <select id="bg-style-selector" class="w-full p-2.5 bg-slate-900/50 border border-slate-700 rounded-xl outline-none text-white text-sm focus:ring-2 focus:ring-[var(--primary-color)]">
                                <option value="cosmos">âœ¨ Cosmos (Animado)</option>
                                <option value="deep">ğŸŒ‘ Deep Space (SÃ³lido)</option>
                                <option value="sunset">ğŸŒ… Sunset (Gradiente)</option>
                                <option value="matrix">ğŸ’» Matrix (Cyber Grid)</option>
                                <option value="aurora">ğŸŒŒ Aurora</option>
                                <option value="grid">ğŸŸ¤ Minimal Grid</option>
                                <option value="nebula">ğŸŒŒ Nebula (Animado)</option>
                                <option value="ocean">ğŸŒŠ Ocean Wave</option>
                                <option value="cybergrid">ğŸ§¬ Cyber Grid</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Fundo do Chat</label>
                            <select id="chat-bg-selector" class="w-full p-2.5 bg-slate-900/50 border border-slate-700 rounded-xl outline-none text-white text-sm focus:ring-2 focus:ring-[var(--primary-color)]">
                                <option value="cartoon">ğŸ¨ Cartoon</option>
                                <option value="whatsapp">ğŸ’¬ WhatsApp</option>
                                <option value="whatsapp-light">ğŸ’­ WhatsApp Claro</option>
                                <option value="nebula">ğŸŒŒ Nebulosa</option>
                                <option value="glass">ğŸ§Š Vidro</option>
                                <option value="grid">ğŸ”² Grade</option>
                                <option value="gradient">ğŸŒˆ Gradiente</option>
                                <option value="dark">ğŸŒ‘ Escuro</option>
                                <option value="light">â˜€ï¸ Claro</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Estilo dos BalÃµes</label>
                            <select id="bubble-style-selector" class="w-full p-2.5 bg-slate-900/50 border border-slate-700 rounded-xl outline-none text-white text-sm focus:ring-2 focus:ring-[var(--primary-color)]">
                                <option value="astro">âœ¨ Astro Original</option>
                                <option value="modern">ğŸ”µ Moderno</option>
                                <option value="cyber">ğŸ¤– Cyberpunk</option>
                                <option value="neon">âš¡ Neon Glow</option>
                                <option value="pixel">ğŸ‘¾ Pixel Retro</option>
                                <option value="classic">ğŸ’¬ ClÃ¡ssico</option>
                                <option value="soft">â˜ï¸ Soft</option>
                                <option value="comic">ğŸ’¥ Comic</option>
                                <option value="glass">ğŸ§Š Glass</option>
                                <option value="paper">ğŸ“„ Paper</option>
                                <option value="terminal">ğŸ’» Terminal</option>
                                <option value="rpg">âš”ï¸ RPG Medieval</option>
                                <option value="bubblegum">ğŸ­ Bubble Gum</option>
                                <option value="brutalist">ğŸ Brutalista</option>
                                <option value="hologram">ğŸ’ Holograma</option>
                            </select>
                        </div>
                    </div>

                    <!-- PREVIEW AREA RESTORED -->
                    <div id="preview-background" class="mt-2 p-4 rounded-xl border border-white/10 relative overflow-hidden h-32 flex flex-col justify-center gap-3" data-bg-style="cosmos">
                         <!-- Mock Header for Preview context -->
                         <div class="absolute top-0 left-0 right-0 h-1 bg-white/10"></div>
                         
                        <div class="message-wrapper items-start !mb-0 scale-90 origin-left">
                            <div class="chat-bubble">
                                <div class="translated-text text-xs">OlÃ¡! Visualizando...</div>
                            </div>
                        </div>

                        <div class="message-wrapper items-end !mb-0 scale-90 origin-right">
                            <div class="chat-bubble">
                                <div class="translated-text text-xs">Ficou Ã³timo!</div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- PARTE 3: GERENCIAMENTO -->
                <section class="space-y-3 pt-4 border-t border-white/5">
                    <h4 class="text-xs font-bold text-muted-color uppercase tracking-widest pb-1">Gerenciamento</h4>
                    
                    <!-- BotÃ£o Limpar removido daqui -->

                    <button id="clear-data-btn" class="w-full p-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 flex items-center justify-center gap-2 transition-all font-bold text-sm">
                        <i class="fas fa-power-off"></i> Resetar Tudo (Logout)
                    </button>
                </section>
                
                <div class="text-center text-[10px] text-slate-600">
                    Astro Chat v2.2 â€¢ Global Edition
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Estudo -->
    <div id="study-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-0 rounded-2xl max-w-lg w-full flex flex-col max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b border-white/10 flex justify-between items-center bg-[var(--primary-color)] text-white">
                <h3 class="font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Modo Estudo</h3>
                <button id="close-study-modal" class="text-xl hover:text-white/80">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <p class="text-sm text-muted-color mb-2 uppercase font-bold tracking-wider">Frase Original</p>
                <div id="study-original-text" class="text-lg mb-6 p-4 bg-[var(--surface-color)] rounded-xl border border-white/5 leading-relaxed"></div>
                
                <div id="study-result-area" class="hidden">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs font-bold px-2 py-1 rounded bg-pink-500/20 text-pink-400 border border-pink-500/30" id="word-class-badge">Classe</span>
                        <span class="text-xs font-bold px-2 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30" id="word-lang-badge">Idioma</span>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <h4 id="word-translation" class="text-xl font-bold text-[var(--secondary-color)]"></h4>
                        <div id="word-speak-container"></div>
                    </div>
                    
                    <p id="word-explanation" class="text-sm text-[var(--text-color)] mb-4 leading-relaxed mt-2"></p>
                    
                    <div class="bg-black/20 p-3 rounded-lg border-l-2 border-[var(--primary-color)]">
                        <p class="text-xs text-muted-color mb-1">Exemplo</p>
                        <p id="word-example" class="italic text-sm"></p>
                    </div>
                </div>
                <div id="study-loading" class="hidden py-8 flex justify-center">
                    <div class="splash-loader w-8 h-8 border-2 border-[var(--text-color)] rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de CorreÃ§Ã£o Gramatical -->
    <div id="grammar-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-0 rounded-2xl max-w-md w-full flex flex-col max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="p-4 border-b border-white/10 flex justify-between items-center bg-emerald-600 text-white">
                <h3 class="font-bold flex items-center gap-2"><i class="fas fa-check-double"></i> RevisÃ£o Gramatical</h3>
                <button id="close-grammar-modal" class="text-xl hover:text-white/80 transition-colors">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div id="grammar-loading" class="flex flex-col items-center justify-center py-8">
                    <div class="splash-loader w-10 h-10 border-4 border-emerald-500 rounded-full mb-3"></div>
                    <p class="text-emerald-400 text-sm animate-pulse">Analisando frase...</p>
                </div>
                
                <div id="grammar-result" class="hidden flex-col gap-4">
                    <!-- Estado: Sem Erros -->
                    <div id="grammar-success" class="hidden flex-col items-center text-center py-4">
                        <div class="w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mb-3">
                            <i class="fas fa-check text-3xl text-emerald-400"></i>
                        </div>
                        <h4 class="text-lg font-bold text-white">Tudo certo!</h4>
                        <p class="text-muted-color text-sm">Nenhum erro encontrado na sua frase.</p>
                    </div>

                    <!-- Estado: Com Erros -->
                    <div id="grammar-errors" class="hidden flex-col gap-4">
                        <div>
                            <p class="text-xs text-muted-color uppercase font-bold tracking-wider mb-1">Sua Frase</p>
                            <div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-100 line-through decoration-red-400/50 decoration-2" id="grammar-original"></div>
                        </div>

                        <div class="flex justify-center text-white/20">
                            <i class="fas fa-arrow-down"></i>
                        </div>

                        <div>
                            <p class="text-xs text-muted-color uppercase font-bold tracking-wider mb-1">SugestÃ£o</p>
                            <div class="p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-100 font-medium shadow-inner" id="grammar-suggestion"></div>
                        </div>

                        <div class="bg-[var(--surface-color)] p-4 rounded-xl border border-white/5 mt-2">
                            <h5 class="text-sm font-bold text-[var(--secondary-color)] mb-2 flex items-center gap-2">
                                <i class="fas fa-info-circle"></i> ExplicaÃ§Ã£o
                            </h5>
                            <p id="grammar-explanation" class="text-sm text-[var(--text-color)] leading-relaxed"></p>
                        </div>

                        <button id="apply-correction-btn" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold p-3 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 mt-2">
                            <i class="fas fa-check"></i> Aplicar CorreÃ§Ã£o
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal GenÃ©rico -->
    <div id="generic-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-6 rounded-2xl max-w-md w-full flex flex-col gap-4">
            <div class="flex justify-between items-center">
                 <h3 class="text-xl font-bold" id="generic-modal-title">Resultado</h3>
                 <button id="close-generic-modal" class="text-2xl text-muted-color hover:text-text-color">&times;</button>
            </div>
            <div id="generic-modal-content" class="text-[var(--text-color)] leading-relaxed max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="room-actions-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-6 rounded-2xl max-w-sm w-full flex flex-col gap-5">
            <div class="flex justify-between items-center">
                 <h3 class="text-xl font-bold">Nova Conversa</h3>
                 <button id="close-room-actions-modal-btn" class="text-2xl text-muted-color hover:text-text-color">&times;</button>
            </div>
           <div class="p-6 space-y-6">
                <!-- SeÃ§Ã£o Criar -->
                <div class="space-y-3">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Criar Nova Sala</label>
                    <input type="text" id="modal-room-name-input" placeholder="Nome da sala (ex: FamÃ­lia, Estudo...)" class="w-full p-3 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="modal-create-room-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2">
                        <i class="fas fa-plus"></i> Gerar Sala Privada
                    </button>
                </div>

                <div class="relative flex items-center py-2">
                    <div class="flex-grow border-t border-white/5"></div>
                    <span class="flex-shrink mx-4 text-[10px] text-slate-500 font-bold uppercase tracking-widest">Ou Entrar</span>
                    <div class="flex-grow border-t border-white/5"></div>
                </div>

                <!-- SeÃ§Ã£o Entrar -->
                <div class="space-y-3">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">CÃ³digo de Acesso</label>
                    <div class="flex gap-2">
                        <input type="text" id="modal-room-code-input" placeholder="CÃ“DIGO" class="flex-1 p-3 bg-white/5 border border-white/10 rounded-xl text-center uppercase font-mono font-bold text-white tracking-widest outline-none focus:ring-2 focus:ring-emerald-500">
                        <button id="modal-confirm-join-btn" class="w-12 h-12 bg-emerald-600 hover:bg-emerald-500 rounded-xl flex items-center justify-center text-white"><i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- MAIN APP SCRIPT -->
    <script type="module" src="app.js"></script>
</body>
</html>