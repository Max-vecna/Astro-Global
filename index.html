<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Astro Chat - Global Edition</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2554/2554978.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Fonte Pixelada para o estilo Retro -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">

   <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="dark" data-bubble-style="astro" data-bg-style="cosmos">
    
    <!-- Script para altura mobile -->
    <script>
        const setAppHeight = () => {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        };
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-slate-900 transition-opacity duration-500">
        <div class="flex items-center text-5xl font-bold text-slate-200 z-10">
            <i class="fas fa-globe-americas mr-3 text-indigo-500 animate-pulse"></i>
            <span>Astro</span>
        </div>
        <div class="splash-loader w-12 h-12 border-4 border-slate-700 rounded-full mt-12 z-10"></div>
        <p class="absolute bottom-10 text-slate-500 text-center px-4 z-10">Conectando mundos e idiomas.</p>
    </div>

    <!-- App Container -->
    <div id="app-container" class="w-full h-full flex items-center justify-center opacity-0 transition-opacity duration-500" style="height: var(--app-height);">
        
        <!-- Nickname Screen -->
        <div id="nickname-screen" class="w-full max-w-sm p-6 glassmorphism rounded-2xl shadow-lg flex-col gap-5 hidden sm:max-w-md md:max-w-lg">
             <h2 class="text-2xl font-bold text-center flex items-center justify-center gap-3"><i class="fas fa-user-astronaut text-indigo-400"></i>Identifica√ß√£o</h2>
            
            <!-- Campo Nome -->
            <div>
                <label for="nickname-input" class="text-sm font-medium text-muted-color">Seu Apelido</label>
                <input type="text" id="nickname-input" placeholder="Viajante Estelar" class="w-full mt-1 p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 text-center text-white">
            </div>

            <!-- Campo Idioma -->
            <div>
                <label for="intro-lang-selector" class="text-sm font-medium text-muted-color">Seu Idioma Principal</label>
                <div class="relative mt-1">
                     <select id="intro-lang-selector" class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 text-white cursor-pointer">
                        <option value="pt">üáßüá∑ Portugu√™s</option>
                        <option value="en">üá∫üá∏ English</option>
                        <option value="es">üá™üá∏ Espa√±ol</option>
                        <option value="fr">üá´üá∑ Fran√ßais</option>
                        <option value="de">üá©üá™ Deutsch</option>
                        <option value="it">üáÆüáπ Italiano</option>
                        <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                        <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                     </select>
                     <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"></i>
                </div>
            </div>

            <button id="save-nickname-btn" class="w-full bg-[var(--primary-color)] hover:opacity-90 font-bold p-3 rounded-xl transition-all text-lg text-white shadow-lg mt-2">Entrar</button>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="w-full h-full max-w-md flex-col hidden relative sm:max-w-lg md:max-w-2xl bg-[var(--background-color)] md:bg-transparent md:h-5/6">
             <header class="flex items-center justify-between p-4 glassmorphism md:rounded-t-2xl z-10">
                <h2 class="text-xl font-bold">Conversas</h2>
                <div class="flex items-center gap-3">
                    <p class="text-sm">Ol√°, <span id="lobby-nickname" class="font-bold text-[var(--primary-color)]"></span>!</p>
                    <button id="change-nickname-btn" class="text-muted-color hover:text-text-color transition-colors"><i class="fas fa-edit"></i></button>
                </div>
            </header>
            
            <main id="room-list-container" class="md:rounded-b-2xl flex-1 overflow-y-auto p-4 space-y-3 scroll-container md:bg-[var(--surface-color)] md:bg-opacity-90"></main>

            <div class="absolute bottom-6 left-6 z-20">
                 <button id="settings-btn" class="w-14 h-14 bg-[var(--surface-color)] hover:bg-opacity-80 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 border border-white/10 text-[var(--text-color)]">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>

            <div id="new-conversation-container" class="absolute bottom-6 right-6 z-20">
                 <button id="new-conversation-btn" class="w-16 h-16 bg-[var(--primary-color)] hover:opacity-90 rounded-full flex items-center justify-center shadow-lg transition-transform duration-300 transform hover:scale-110 text-white">
                    <i class="fas fa-plus text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Chat Screen -->
        <div id="chat-screen" class="w-full h-full flex-col hidden bg-[var(--background-color)] md:max-w-4xl md:h-5/6 md:rounded-2xl md:shadow-2xl md:border md:border-white/5 relative">
            <header class="flex items-center justify-between p-3 glassmorphism md:rounded-t-2xl z-10 gap-2">
                <div class="flex items-center gap-2">
                    <button id="leave-btn" class="p-2 rounded-full hover:bg-white/10 text-lg transition-colors text-[var(--text-color)]">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div>
                        <div class="relative group cursor-pointer flex flex-col" id="room-code-wrapper">
                            <h2 class="font-bold text-lg text-[var(--text-color)] leading-tight flex items-center gap-2">
                                #<span class="room-code-value tracking-wider"></span>
                            </h2>
                            <p id="user-count-display" class="text-xs text-green-400 font-medium"></p>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <!-- Bot√£o de Notifica√ß√£o -->
                    <button id="notif-btn" class="text-[var(--text-muted-color)] hover:text-[var(--primary-color)] transition-colors p-1" title="Ativar Notifica√ß√µes">
                        <i class="fas fa-bell-slash"></i>
                    </button>

                    <!-- Seletor de Idioma da Sala -->
                    <div class="flex items-center gap-2">
                        <i class="fas fa-language text-[var(--text-muted-color)]"></i>
                        <select id="room-lang-selector" title="Seu idioma pessoal para tradu√ß√£o">
                            <option value="pt">Portugu√™s</option>
                            <option value="en">English</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="de">Deutsch</option>
                            <option value="it">Italiano</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                            <option value="zh">‰∏≠Êñá</option>
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                        </select>
                    </div>

                    <div class="flex items-center -space-x-2" id="user-avatars-container"></div>
                </div>
            </header>

            <main id="messages-container" class="flex-1 p-4 overflow-y-auto flex flex-col scroll-container bg-[var(--surface-color)]/30">
                <div id="messages-list" class="flex flex-col gap-1 pb-4">
                    <div id="typing-indicator-container" class="h-8 transition-all duration-300"></div>
                </div>
            </main>

            <!-- Footer / Input Area -->
            <footer class="p-3 glassmorphism md:rounded-b-2xl z-20">                
                <div id="reply-preview" class="hidden mb-2 p-2 rounded-lg bg-black/20 border-l-4 border-[var(--secondary-color)]"></div>
                
                <div class="flex items-end gap-2 w-full">
                    <div class="flex-1 relative">
                        <textarea id="message-input" rows="1" placeholder="Digite uma mensagem..." class="w-full bg-[var(--surface-color)] text-[var(--text-color)] rounded-2xl py-3 px-4 outline-none focus:ring-2 focus:ring-[var(--primary-color)] border border-white/5 resize-none overflow-hidden max-h-32" style="min-height: 48px;"></textarea>
                    </div>
                    
                    <!-- Bot√µes de A√ß√£o Agrupados e Alinhados -->
                    <div class="flex items-center gap-1 shrink-0">
                        <button id="grammar-check-btn" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 hover:bg-white/10 text-emerald-400" title="Corrigir Gram√°tica">
                            <i class="fas fa-check-double text-lg"></i>
                        </button>

                        <button id="rewrite-btn" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 hover:bg-white/10 text-purple-400" title="Melhorar texto com IA">
                            <i class="fas fa-magic text-lg"></i>
                        </button>

                        <button id="send-btn" class="bg-[var(--primary-color)] hover:opacity-90 w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-transform active:scale-90 shadow-lg text-white">
                            <i class="fas fa-paper-plane text-lg"></i>
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm overflow-y-auto">
        <div class="glassmorphism p-6 rounded-2xl max-w-sm w-full flex flex-col gap-4 my-auto">
            <div class="flex justify-between items-center">
                 <h3 class="text-xl font-bold">Configura√ß√µes</h3>
                 <button id="close-settings-modal-btn" class="text-2xl text-muted-color hover:text-text-color">&times;</button>
            </div>
            
            <!-- Tema Light/Dark -->
            <div>
                <label class="text-sm font-medium text-muted-color mb-2 block">Tema do App</label>
                <div class="flex gap-3">
                    <button data-theme="dark" class="theme-btn flex-1 p-3 rounded-xl border-2 border-transparent bg-slate-800 text-white flex flex-col items-center gap-1 transition-all">
                        <i class="fas fa-moon"></i> Dark
                    </button>
                    <button data-theme="light" class="theme-btn flex-1 p-3 rounded-xl border-2 border-transparent bg-slate-200 text-black flex flex-col items-center gap-1 transition-all">
                        <i class="fas fa-sun"></i> Light
                    </button>
                </div>
            </div>

            <!-- Estilo do Fundo (NOVO) -->
             <div>
                <label class="text-sm font-medium text-muted-color mb-2 block">Plano de Fundo</label>
                <div class="relative">
                    <select id="bg-style-selector" class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-[var(--primary-color)] text-white cursor-pointer appearance-none">
                        <option value="cosmos">‚ú® Cosmos (Animado)</option>
                        <option value="deep">üåë Deep Space (S√≥lido)</option>
                        <option value="sunset">üåÖ Sunset (Gradiente)</option>
                        <option value="matrix">üíª Matrix (Cyber Grid)</option>
                    </select>
                    <i class="fas fa-image absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"></i>
                </div>
            </div>

            <!-- Estilo dos Bal√µes -->
            <div>
                <label class="text-sm font-medium text-muted-color mb-2 block">Estilo dos Bal√µes</label>
                <div class="relative">
                    <select id="bubble-style-selector" class="w-full p-3 bg-slate-900/50 border border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-[var(--primary-color)] text-white cursor-pointer appearance-none">
                        <option value="astro">‚ú® Astro Original</option>
                        <option value="modern">üîµ Moderno</option>
                        <option value="cyber">ü§ñ Cyberpunk</option>
                        <option value="neon">‚ö° Neon Glow (Novo)</option>
                        <option value="pixel">üëæ Pixel Retro (Novo)</option>
                        <option value="classic">üí¨ Cl√°ssico</option>
                        <option value="soft">‚òÅÔ∏è Soft</option>
                        <option value="comic">üí• Comic</option>
                    </select>
                    <i class="fas fa-paint-brush absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"></i>
                </div>
                
                <!-- √ÅREA DE VISUALIZA√á√ÉO (PREVIEW) NOVO -->
                <div class="mt-4 p-4 rounded-xl border border-white/10 bg-black/40 relative overflow-hidden">
                    <p class="text-[10px] text-muted-color mb-3 text-center uppercase tracking-widest font-bold z-10 relative">Pr√©-visualiza√ß√£o</p>
                    
                    <div class="flex flex-col gap-3 pointer-events-none z-10 relative">
                        <!-- Bal√£o do outro (Received) -->
                        <div class="message-wrapper items-start !mb-0">
                            <div class="chat-bubble">
                                <div class="translated-text">Ol√°! Tudo bem?</div>
                                <div class="original-text">Hello! How are you?</div>
                            </div>
                        </div>
                        
                        <!-- Bal√£o do pr√≥prio usu√°rio (Sent) -->
                        <div class="message-wrapper items-end !mb-0">
                            <div class="chat-bubble">
                                <div class="translated-text">Tudo √≥timo!</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-white/10 pt-4">
                <button id="clear-data-btn" class="w-full p-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 flex items-center justify-center gap-2 transition-all font-bold text-sm">
                    <i class="fas fa-trash-alt"></i> Limpar Dados / Sair
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Estudo -->
    <div id="study-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-0 rounded-2xl max-w-lg w-full flex flex-col max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b border-white/10 flex justify-between items-center bg-[var(--primary-color)] text-white">
                <h3 class="font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Modo Estudo</h3>
                <button id="close-study-modal" class="text-xl hover:text-white/80">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <p class="text-sm text-muted-color mb-2 uppercase font-bold tracking-wider">Frase Original</p>
                <div id="study-original-text" class="text-lg mb-6 p-4 bg-[var(--surface-color)] rounded-xl border border-white/5 leading-relaxed"></div>
                
                <div id="study-result-area" class="hidden">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs font-bold px-2 py-1 rounded bg-pink-500/20 text-pink-400 border border-pink-500/30" id="word-class-badge">Classe</span>
                        <span class="text-xs font-bold px-2 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30" id="word-lang-badge">Idioma</span>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <h4 id="word-translation" class="text-xl font-bold text-[var(--secondary-color)]"></h4>
                        <div id="word-speak-container"></div>
                    </div>
                    
                    <p id="word-explanation" class="text-sm text-[var(--text-color)] mb-4 leading-relaxed mt-2"></p>
                    
                    <div class="bg-black/20 p-3 rounded-lg border-l-2 border-[var(--primary-color)]">
                        <p class="text-xs text-muted-color mb-1">Exemplo</p>
                        <p id="word-example" class="italic text-sm"></p>
                    </div>
                </div>
                <div id="study-loading" class="hidden py-8 flex justify-center">
                    <div class="splash-loader w-8 h-8 border-2 border-[var(--text-color)] rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Corre√ß√£o Gramatical -->
    <div id="grammar-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-0 rounded-2xl max-w-md w-full flex flex-col max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="p-4 border-b border-white/10 flex justify-between items-center bg-emerald-600 text-white">
                <h3 class="font-bold flex items-center gap-2"><i class="fas fa-check-double"></i> Revis√£o Gramatical</h3>
                <button id="close-grammar-modal" class="text-xl hover:text-white/80 transition-colors">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div id="grammar-loading" class="flex flex-col items-center justify-center py-8">
                    <div class="splash-loader w-10 h-10 border-4 border-emerald-500 rounded-full mb-3"></div>
                    <p class="text-emerald-400 text-sm animate-pulse">Analisando frase...</p>
                </div>
                
                <div id="grammar-result" class="hidden flex-col gap-4">
                    <!-- Estado: Sem Erros -->
                    <div id="grammar-success" class="hidden flex-col items-center text-center py-4">
                        <div class="w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mb-3">
                            <i class="fas fa-check text-3xl text-emerald-400"></i>
                        </div>
                        <h4 class="text-lg font-bold text-white">Tudo certo!</h4>
                        <p class="text-muted-color text-sm">Nenhum erro encontrado na sua frase.</p>
                    </div>

                    <!-- Estado: Com Erros -->
                    <div id="grammar-errors" class="hidden flex-col gap-4">
                        <div>
                            <p class="text-xs text-muted-color uppercase font-bold tracking-wider mb-1">Sua Frase</p>
                            <div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-100 line-through decoration-red-400/50 decoration-2" id="grammar-original"></div>
                        </div>

                        <div class="flex justify-center text-white/20">
                            <i class="fas fa-arrow-down"></i>
                        </div>

                        <div>
                            <p class="text-xs text-muted-color uppercase font-bold tracking-wider mb-1">Sugest√£o</p>
                            <div class="p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-100 font-medium shadow-inner" id="grammar-suggestion"></div>
                        </div>

                        <div class="bg-[var(--surface-color)] p-4 rounded-xl border border-white/5 mt-2">
                            <h5 class="text-sm font-bold text-[var(--secondary-color)] mb-2 flex items-center gap-2">
                                <i class="fas fa-info-circle"></i> Explica√ß√£o
                            </h5>
                            <p id="grammar-explanation" class="text-sm text-[var(--text-color)] leading-relaxed"></p>
                        </div>

                        <button id="apply-correction-btn" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold p-3 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 mt-2">
                            <i class="fas fa-check"></i> Aplicar Corre√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gen√©rico -->
    <div id="generic-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-6 rounded-2xl max-w-md w-full flex flex-col gap-4">
            <div class="flex justify-between items-center">
                 <h3 class="text-xl font-bold" id="generic-modal-title">Resultado</h3>
                 <button id="close-generic-modal" class="text-2xl text-muted-color hover:text-text-color">&times;</button>
            </div>
            <div id="generic-modal-content" class="text-[var(--text-color)] leading-relaxed max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="room-actions-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="glassmorphism p-6 rounded-2xl max-w-sm w-full flex flex-col gap-5">
            <div class="flex justify-between items-center">
                 <h3 class="text-xl font-bold">Nova Conversa</h3>
                 <button id="close-room-actions-modal-btn" class="text-2xl text-muted-color hover:text-text-color">&times;</button>
            </div>
            <button id="modal-create-room-btn" class="w-full bg-[var(--primary-color)] text-white hover:opacity-90 font-bold p-4 rounded-xl transition-all flex items-center justify-center gap-3 text-lg shadow-lg">
                <i class="fas fa-plus-circle"></i> Criar Sala Privada
            </button>
            <div class="relative flex py-2 items-center"><div class="flex-grow border-t border-white/10"></div><span class="flex-shrink mx-4 text-muted-color text-sm">OU</span><div class="flex-grow border-t border-white/10"></div></div>
            <div>
                 <label class="text-sm font-medium text-muted-color mb-2 block">C√≥digo da Sala</label>
                 <div class="flex gap-2">
                    <input type="text" id="modal-room-code-input" placeholder="C√ìDIGO" class="flex-1 p-3 bg-[var(--surface-color)] border border-white/10 rounded-xl outline-none focus:ring-2 focus:ring-[var(--primary-color)] text-center uppercase tracking-widest font-bold text-white">
                    <button id="modal-confirm-join-btn" class="bg-emerald-600 hover:bg-emerald-700 p-3 rounded-xl font-bold aspect-square flex items-center justify-center transition-colors text-white"><i class="fas fa-arrow-right"></i></button>
                 </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- MAIN APP SCRIPT -->
    <script type="module" src="app.js"></script>
</body>
</html>